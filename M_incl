# set default platform
ifndef platform
  platform = LINUX_64_gcc
endif

# set default debug
ifndef debug
  debug = 0
endif

# set directory paths
ifndef VIZMO_DIR
  VIZMO_DIR = .
endif

UTILS_DIR = $(VIZMO_DIR)/utils

# include makefile defaults
include ${UTILS_DIR}/makefile_includes/Makefile.defaults

RPM = 0

#--------------------------------------------------------------------
# Xlib
#--------------------------------------------------------------------

#X_LIB  = -L/usr/X11R6/lib -L/usr/local/lib -lX11 -lXmu -lXi -lICE -lSM -lXrender -lXft -lXt -lXrandr -lXcursor -lXinerama -lXfixes

#Phantom_LIB = -lHD -lHDU -lrt

GL_LIB = -lglut -lGLU -lGL -lm
GL_INCL = -I/usr/include/GL/

GLI_DIR = $(VIZMO_DIR)
GLI_INCL = -I/sw/include -I/usr/X11/include  -I/usr/X11/include/GL
GLI_LIB = -lgli
#--------------------------------------------------------------------

VIZMO_INCL = -I$(VIZMO_DIR)
VIZMO_LIB = -L$(VIZMO_DIR)/lib

MODELGRAPH_DIR = $(VIZMO_DIR)/modelgraph
MODELGRAPH_INCL = -I$(MODELGRAPH_DIR)
MODELGRAPH_LIB = -lmodelgraph

PLUM_DIR = $(VIZMO_DIR)/Plum
PLUM_INCL = -I$(PLUM_DIR)
PLUM_LIB = -lPlum

VGUI_LIB = -lvgui

#MOC	 = /usr/lib/qt4/bin/moc
#MOC      = /usr/lib64/qt4/bin/moc
MOC	 = /usr/share/qt4/bin/moc
#MOC = /sw/lib/qt4-x11/bin/moc

#QT4DIR = /usr/
QT4DIR = /usr/share/qt4
#QT4DIR = /sw/lib/qt4-x11/

QT_INC = -I$(QT4DIR)/include -I$(QT4DIR)/include/QtGui -I$(QT4DIR)/include/QtCore -I$(QT4DIR)/include/QtOpenGL -I$(QT4DIR)/include/Qt3Support -I$(QT4DIR)/mkspecs/default -DQT3_SUPPORT
QT_LIBS = -L$(QT4DIR)/lib  -lQt3Support -lQtCore -lQtGui -lQtOpenGL -lQtNetwork -lpthread #-lXext -lz 

GRAPH_DIR = $(UTILS_DIR)/graph
GRAPH_INCL = -I$(GRAPH_DIR)

# mathtool
MATHTOOL_DIR = ${UTILS_DIR}/mathtool
MATHTOOL_LIB = -L${MATHTOOL_DIR} -lmathtool
MATHTOOL_INCL = -I${MATHTOOL_DIR}
${MATHTOOL_DIR}/libmathtool.a:
	cd ${MATHTOOL_DIR}; ${MAKE} platform=${platform} debug=${debug}; cp libmathtool.a ../../lib

MATHTOOL_LIBFILE = ${MATHTOOL_DIR}/libmathtool.a

# modelloader
MODELLOADER_DIR = ${UTILS_DIR}/modelloader
MODELLOADER_LIB = -L${MODELLOADER_DIR} -lmodloader
MODELLOADER_INCL = -I${MODELLOADER_DIR}
${MODELLOADER_DIR}/libmodloader.a: 
	cd ${MODELLOADER_DIR}; ${MAKE} platform=${platform} debug=${debug}

MODELLOADER_LIBFILE = ${MODELLOADER_DIR}/libmodloader.a

#--------------------------------------------------------------------------
# collision detection
#--------------------------------------------------------------------------
RAPID_DIR     = $(UTILS_DIR)/geom/CD-libs/RAPID
RAPID_LIB      = -L$(RAPID_DIR) -lRAPID
RAPID_INCL    = -I${RAPID_DIR}
${RAPID_DIR}/libRAPID.a:
	cd ${RAPID_DIR}; ${MAKE} platform=${platform} debug=${debug}; cp libRAPID.a ../../../../lib

RAPID_LIBFILE = ${RAPID_DIR}/libRAPID.a

CD_DIR = $(VIZMO_DIR)/CollisionDetection
CD_INCL = -I$(CD_DIR)
CD_LIB = -lCD
#-------------------------------------------------------------------------

#INCLUDE = \ #-I. -I/usr/X12R6/include -I/usr/local/include 
INCLUDE = $(VIZMO_INCL) $(PLUM_INCL) $(MODELGRAPH_INCL) $(GLI_INCL) $(CD_INCL) \
          $(GRAPH_INCL) $(QT_INC) $(GL_INCL) $(INCPATH) $(RAPID_INCL) $(MATHTOOL_INCL) $(MODELLOADER_INCL)
LIB = $(VIZMO_LIB) $(PLUM_LIB) $(MODELGRAPH_LIB) $(VGUI_LIB) $(GLI_LIB) $(QT_LIBS) $(GL_LIB) $(X_LIB) $(CD_LIB) ${RAPID_LIB} \
      ${Phantom_LIB} $(MATHTOOL_LIB) $(MODELLOADER_LIB)

# macros
OPTS += -MMD -fPIC 
INCL = $(INCLUDE)
LIBS = $(LIB)

%.o: %.cpp
	@${MAKE} -s check_platform
	${CXX} -c ${CXXFLAGS} ${OPTS} ${DEFS} ${INCL} ${DEPS} $< -o $@
	cat $*.d >> Dependencies
	rm -f $*.d

