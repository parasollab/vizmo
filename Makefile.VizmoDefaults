# set default platform
ifndef platform
  platform = LINUX_64_gcc
endif

# set default debug
ifndef debug
  debug = 0
endif

# set directory paths
ifndef VIZMO_DIR
  VIZMO_DIR = .
endif

UTILS_DIR = $(VIZMO_DIR)/utils

# include makefile defaults
include ${UTILS_DIR}/makefile_includes/Makefile.defaults

#Phantom_LIB = -lHD -lHDU -lrt

GL_LIB = -lglut -lGLU -lGL
GL_INCL = -I/usr/include/GL
GLI_LIB = -lgli

VIZMO_INCL = -I$(VIZMO_DIR)
VIZMO_LIB = -L$(VIZMO_DIR)/lib

MODELGRAPH_DIR = $(VIZMO_DIR)/modelgraph
MODELGRAPH_INCL = -I$(MODELGRAPH_DIR)
MODELGRAPH_LIB = -lmodelgraph

PLUM_DIR = $(VIZMO_DIR)/Plum
PLUM_INCL = -I$(PLUM_DIR)
PLUM_LIB = -lPlum

VGUI_LIB = -lvgui

ifeq ($(platform), LINUX_gcc)
MOC	 = /usr/lib64/qt4/bin/moc
#MOC	 = /usr/share/qt4/bin/moc
QT4DIR = /usr
#QT4DIR = /usr/share/qt4
endif
ifeq ($(platform), LINUX_64_gcc)
MOC      = /usr/lib/qt4/bin/moc
QT4DIR = /usr
endif
ifeq ($(platform), MACOS_gcc)
MOC = /sw/lib/qt4-x11/bin/moc
QT4DIR = /sw/lib/qt4-x11/
endif

QT_INC = -I$(QT4DIR)/include -I$(QT4DIR)/include/QtCore -I$(QT4DIR)/include/QtGui -I$(QT4DIR)/include/QtOpenGL 
QT_LIBS = -L$(QT4DIR)/lib -lQtCore -lQtGui -lQtOpenGL  

GRAPH_DIR = $(UTILS_DIR)/graph
GRAPH_INCL = -I$(GRAPH_DIR)

# mathtool
MATHTOOL_DIR = ${UTILS_DIR}/mathtool
MATHTOOL_LIB = -L${MATHTOOL_DIR} -lmathtool
MATHTOOL_INCL = -I${MATHTOOL_DIR}
${MATHTOOL_DIR}/libmathtool.a:
	cd ${MATHTOOL_DIR}; ${MAKE} platform=${platform} debug=${debug}; cp libmathtool.a ../../lib

MATHTOOL_LIBFILE = ${MATHTOOL_DIR}/libmathtool.a

# modelloader
MODELLOADER_DIR = ${UTILS_DIR}/modelloader
MODELLOADER_LIB = -L${MODELLOADER_DIR} -lmodloader
MODELLOADER_INCL = -I${MODELLOADER_DIR}
${MODELLOADER_DIR}/libmodloader.a: 
	cd ${MODELLOADER_DIR}; ${MAKE} platform=${platform} debug=${debug}

MODELLOADER_LIBFILE = ${MODELLOADER_DIR}/libmodloader.a

#--------------------------------------------------------------------------
# collision detection
#--------------------------------------------------------------------------
RAPID_DIR     = $(UTILS_DIR)/geom/CD-libs/RAPID
RAPID_LIB      = -L$(RAPID_DIR) -lRAPID
RAPID_INCL    = -I${RAPID_DIR}
${RAPID_DIR}/libRAPID.a:
	cd ${RAPID_DIR}; ${MAKE} platform=${platform} debug=${debug}; cp libRAPID.a ../../../../lib

RAPID_LIBFILE = ${RAPID_DIR}/libRAPID.a

CD_DIR = $(VIZMO_DIR)/CollisionDetection
CD_INCL = -I$(CD_DIR)
CD_LIB = -lCD
#-------------------------------------------------------------------------

INCLUDE = $(VIZMO_INCL) $(PLUM_INCL) $(MODELGRAPH_INCL) $(GLI_INCL) $(CD_INCL) \
          $(GRAPH_INCL) $(QT_INC) $(GL_INCL) $(INCPATH) $(RAPID_INCL) $(MATHTOOL_INCL) $(MODELLOADER_INCL)
LIB = $(VIZMO_LIB) $(PLUM_LIB) $(MODELGRAPH_LIB) $(VGUI_LIB) $(GLI_LIB) $(QT_LIBS) $(GL_LIB) $(CD_LIB) ${RAPID_LIB} \
      ${Phantom_LIB} $(MATHTOOL_LIB) $(MODELLOADER_LIB)

# macros
OPTS += -MMD
INCL = $(INCLUDE)
LIBS = $(LIB)

default_target: $(TARGET)
$(TARGET): $(OBJECTS)

%.o: %.cpp
	@${MAKE} -s check_platform
	${CXX} -c ${CXXFLAGS} ${OPTS} ${DEFS} ${INCL} ${DEPS} $< -o $@
	cat $*.d >> Dependencies
	rm -f $*.d

%.a: $(OBJECTS)
	$(AR) $@ $(OBJECTS)

CLEAN= $(TARGET) $(OBJECTS) Dependencies *~

-include Dependencies

